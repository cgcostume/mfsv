<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>mfsv</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
	</body>

	<script src="js/Three.js"></script>
	<script src="js/OBJLoader.js"></script>
	<script src="js/TrackballControls.js"></script>

	<!-- Shaders -->
	<script type="x-shader/x-vertex" id="vertexShader">
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif
		varying vec3 vNormal;
		void main() {
		    vNormal = normal;
		    gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
		}
	</script>

	<script type="x-shader/x-fragment" id="fragmentShader">
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif
		varying vec3 vNormal;

		void main() {
		    vec3 light = vec3(0.5,0.2,1.0);
		    light = normalize(light);
		    float dProd = max(0.0, dot(vNormal, light));
		    gl_FragColor = vec4(dProd, dProd, dProd, 1.0);
			}
	</script>



	<script type="text/javascript">

	var camera, controls, scene, renderer;

	init();
	animate();

	function init() {
		// initialize camera
		camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
		camera.position.z = 7;

		// prepare scene
		scene = new THREE.Scene();
		scene.add(camera);

		// load shaders -- todo: Use RawShaderMaterial
		var shaderMaterial = new THREE.ShaderMaterial({
			vertexShader:   document.getElementById('vertexShader').textContent,
			fragmentShader: document.getElementById('fragmentShader').textContent
		});

		// load and add teapot to the scene
		var manager = new THREE.LoadingManager();
		manager.onProgress = function ( item, loaded, total ) {
			console.log( item, loaded, total );
		};
		var loader = new THREE.OBJLoader(manager);
		loader.load('obj/teapot.obj', function (object) {
			object.traverse( function ( child ) {
							if ( child instanceof THREE.Mesh ) {
								child.material = shaderMaterial;
							}
						} );
			scene.add(object);
			render();
		} );

		// prepare renderer
		renderer = new THREE.WebGLRenderer( { antialias: false } );
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.setPixelRatio(window.devicePixelRatio);

		// attach the render-supplied DOM element
		document.body.appendChild(renderer.domElement);
		window.addEventListener('resize', onWindowResize, false);

		// configure controls
		controls = new THREE.TrackballControls(camera);
		controls.addEventListener('change', render);
		controls.target.set(0, 0, 0);
		controls.rotateSpeed = 5.0;
		controls.zoomSpeed = 1.2;
		controls.panSpeed = 0.8;
		controls.noZoom = false;
		controls.noPan = false;
		controls.staticMoving = true;
		controls.dynamicDampingFactor = 0.3;
		controls.keys = [ 65, 83, 68 ];
	}

	function animate() {
		requestAnimationFrame(animate);
		controls.update();
	}

	function render() {
		camera.lookAt(scene.position);
		renderer.render(scene, camera);
	}

	function onWindowResize() {
		camera.aspect = window.innerWidth / window.innerHeight;
		renderer.setSize(window.innerWidth, window.innerHeight);
		camera.updateProjectionMatrix();
		controls.handleResize();
		render();
	}
	</script>
</html>
